FROM adoptopenjdk:11-jre-hotspot

LABEL maintainer="Alberto Monteiro <alberto.costa.monteiro@gmail.com>"

## Server Port
ENV BLYNK_SERVER_VERSION 0.41.17-SNAPSHOT
ENV HARDWARE_MQTT_PORT 8440
ENV HTTP_PORT 8080
ENV HTTPS_PORT 9443

# CERTIFICATES
ENV SERVER_SSL_CERT ''
ENV SERVER_SSL_KEY ''
ENV SERVER_SSL_KEY_PASS ''

## Server
ENV DATA_FOLDER /data
ENV LOGS_FOLDER /data/logs
ENV SERVER_PROPERTIES /data/config/server.properties
ENV MAIL_PROPERTIES /data/config/mail.properties
ENV SERVER_HOST ''
ENV CONTACT_EMAIL ''
ENV LISTEN_ADDRES ''

ENV ADMIN_ROOTPATH /data/admin
ENV ADMIN_EMAIL admin@blynk.cc
ENV ADMIN_PAS ''

ENV USER_TAGS_LIMIT 100
ENV USER_DEVICES_LIMIT 50
ENV NOTIFICATIONS_FREQUENCY_USER_QUOTA_LIMIT 5
ENV USER_PROFILE_MAX_SIZE 256
ENV USER_MESSAGE_QUOTA_LIMIT 100
ENV USER_WIDGET_MAX_SIZE_LIMIT 20
ENV USER_DASHBOARD_MAX_LIMIT 100

ENV ALLOWED_ADMINISTRATOR_IPS 0.0.0.0/0,::/0
ENV RESTORE_HOST blynk-cloud.com
ENV WEB_REQUEST_MAX_SIZE 524288
ENV NET_INTERFACE eth
ENV FORCE_PORT_80_FOR_REDIRECT true
ENV ALLOW_STORE_IP true
ENV FORCE_PORT_80_FOR_CSV false
ENV HARD_SOCKET_IDLE_TIMEOUT 10

ENV PROFILE_SAVE_WORKER_PERIOD 60000
ENV STATS_PRINT_WORKER_PERIOD 60000
ENV LOG_LEVEL info
ENV ASYNC_LOGGER_RING_BUFFER_SIZE 2048
ENV BLOCKING_PROCESSOR_THREAD_POOL_LIMIT 6

ENV ENABLE_RAW_DB_DATA_STORE false
ENV RESTORE false
ENV PRODUCT_NAME Blynk
ENV CSV_EXPORT_DATA_POINTS_MAX 43200
ENV WEBHOOKS_FREQUENCY_USER_QUOTA_LIMIT 1000
ENV INITIAL_ENERGY 100000
ENV TABLE_ROWS_POOL_SIZE 100
ENV MAP_STRINGS_POOL_SIZE 25
ENV LCD_STRINGS_POOL_SIZE 6
ENV WEBHOOKS_RESPONSE_SIZE_LIMIT 96
ENV TERMINAL_STRINGS_POOL_SIZE 25
ENV NOTIFICATIONS_QUEUE_LIMIT 2000
ENV ALLOW_READING_WIDGET_WITHOUT_ACTIVE_APP false

## Email
ENV MAIL_SMTP_AUTH true
ENV MAIL_SMTP_STARTTLS.enable true
ENV MAIL_SMTP_HOST smtp.gmail.com
ENV MAIL_SMTP_PORT 587
ENV MAIL_SMTP_USERNAME example@gmail.com
ENV MAIL_SMTP_PASSWORD ''
ENV MAIL_SMTP_CONNECTIONTIMEOUT 30000
ENV MAIL_SMTP_TIMEOUT 120000

# DB
ENV ENABLE_DB false
ENV JDBC_URL jdbc:postgresql://localhost:5432/blynk?tcpKeepAlive=true&socketTimeout=150
ENV USER test
ENV PASSWORD test
ENV CONNECTION_TIMEOUT_MILLIS 30000
ENV CLEAN_REPORTING true
ENV REPORTING_JDBC_URL jdbc:postgresql://localhost:5432/blynk_reporting?tcpKeepAlive=true&socketTimeout=150
ENV REPORTING_USER test
ENV REPORTING_PASSWORD test
ENV REPORTING_CONNECTION_TIMEOUT_MILLIS 30000

RUN mkdir /app /data
COPY ./bin /app
RUN chmod +x /app/*.sh

WORKDIR /data

VOLUME ["/data"]

EXPOSE ${HARDWARE_MQTT_PORT} ${HTTP_PORT} ${HTTPS_PORT}

ENTRYPOINT ["/app/run.sh"]
